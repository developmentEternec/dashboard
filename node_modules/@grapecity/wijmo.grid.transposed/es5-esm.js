/*!
    *
    * Wijmo Library 5.20211.794
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,r){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(e,r)};return function(e,r){extendStatics(e,r);function __(){this.constructor=e}e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}();import{MergeManager,CellRange,FlexGrid,Row,Column,ColumnCollection,AllowSorting,HeadersVisibility,_ColumnGroupHandler,ColumnGroup}from"@grapecity/wijmo.grid";import{asArray,assert,isArray,isString,isNumber,isUndefined,asBoolean,getTypes,getType,tryCast,toHeaderCase,addClass,DataType,Binding,Control,CollectionView,ObservableArray,NotifyCollectionChangedEventArgs,NotifyCollectionChangedAction,copy,_registerModule}from"@grapecity/wijmo";import*as selfModule from"@grapecity/wijmo.grid.transposed";var _MergeManager=function(e){__extends(_MergeManager,e);function _MergeManager(){return null!==e&&e.apply(this,arguments)||this}_MergeManager.prototype.getMergedRange=function(r,o,t,n){void 0===n&&(n=!0);var i=r.grid;if(r==i.rowHeaders&&i._hasColumnGroups()){if(o<0||o>=r.rows.length||t<0||t>=r.columns.length)return null;var a=i._getColumnGroup(o,t);if(a){var s=a._rng,l=r.rows;if(l.isFrozen(s.row)!=l.isFrozen(s.row2)){s=s.clone();l.isFrozen(o)?s.row2=l.frozen-1:s.row=l.frozen}return s}return null}return e.prototype.getMergedRange.call(this,r,o,t,n)};return _MergeManager}(MergeManager);export{_MergeManager};var TransposedGrid=function(e){__extends(TransposedGrid,e);function TransposedGrid(r,o){var t=e.call(this,r,null)||this;t._keyPrefix="item";t._autoGenRows=!0;addClass(t.hostElement,"wj-transposed-grid");t.allowSorting=AllowSorting.None;t.headersVisibility=HeadersVisibility.Row;t._rowInfo=new ColumnCollection(t,t.columns.defaultSize);t._grpHdl=new _RowGroupHandler(t);t.mergeManager=new _MergeManager;t.initialize(o);t._rowInfo.collectionChanged.addHandler(t._rowInfoChanged,t);t.deferUpdate((function(){var e=t.rowHeaders.columns;if(e.length){e[e.length-1].width=t.columns.defaultSize}}));return t}Object.defineProperty(TransposedGrid.prototype,"autoGenerateRows",{get:function(){return this._autoGenRows},set:function(e){this._autoGenRows=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"rowGroups",{get:function(){return this._grpHdl.getGroupDefinitions()},set:function(e){var r=this;this._rowInfo.deferUpdate((function(){r.autoGenerateRows=!1;r._rowInfo.clear();r._grpHdl.createColumnGroups(asArray(e))}))},enumerable:!0,configurable:!0});TransposedGrid.prototype.refresh=function(r){var o=this._rowInfo;if(o._dirty){o._dirty=!1;this._rowInfoChanged()}else e.prototype.refresh.call(this,r)};Object.defineProperty(TransposedGrid.prototype,"allowAddNew",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"allowDelete",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"allowSorting",{get:function(){return AllowSorting.None},set:function(e){assert(e===AllowSorting.None,"TransposedGrid does not support sorting.");this._alSorting=e},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"columnGroups",{get:function(){return null},set:function(e){throw"TransposedGrid does not support columnGroups, use rowGroups instead."},enumerable:!0,configurable:!0});TransposedGrid.prototype.onRowEditEnded=function(r){var o=tryCast(this._sourceItems,"ICollectionView");if(o){var t=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change);o.collectionChanged.raise(o,t)}e.prototype.onRowEditEnded.call(this,r)};TransposedGrid.prototype._getCollectionView=function(r){var o=this,t=tryCast(this._sourceItems,"ICollectionView");t&&t.collectionChanged.removeHandler(this._sourceViewChanged);t=tryCast(r,"ICollectionView");var n=r;if(isArray(r))n=this._transposeItemsSource(r);else if(t){t.collectionChanged.addHandler(this._sourceViewChanged,this);n=this._transposeItemsSource(t.items)}this.autoGenerateColumns=!0;var i=e.prototype._getCollectionView.call(this,n),a=null;t instanceof CollectionView&&(a=t.getError);a&&i instanceof CollectionView&&(this._supportsProxies()?i.getError=function(e,r){if(null==r)return null;var o=e._keys.indexOf(r);return a(e._arr[o],e._bnd.path)}:i.getError=function(e,r){if(null==r)return null;var t=parseInt(r.substr(o._keyPrefix.length));return a(e._arr[t],e._rowInfo.binding)});this._sourceItems=r;return i};TransposedGrid.prototype._getColumnTypes=function(e){var r,o=this;if(this._sourceItems)if(isArray(this._sourceItems))r=this._sourceItems;else{var t=tryCast(this._sourceItems,"ICollectionView");t&&(r=t.items)}return r?r.map((function(e,r){return{binding:o._keyPrefix+r,dataType:DataType.Object}})):getTypes(e)};TransposedGrid.prototype._copy=function(r,o){var t=this;if(/rows|columns/.test(r)){assert(isArray(o),"Array Expected.");var n=asArray(o);n.some((function(e){return null!=e.columns}))?this.rowGroups=n:this._rowInfo.deferUpdate((function(){t.autoGenerateRows=!1;t._rowInfo.clear();o.forEach((function(e){var r=new TransposedGridRow(e);t._rowInfo.push(r)}))}));return!0}return e.prototype._copy.call(this,r,o)};TransposedGrid.prototype.onLoadedRows=function(r){for(var o=this,t=this.columns,n=0;n<t.length;n++){var i=t[n];i.align=null;i.dataType=0}var a=this.rowHeaders.columns;for(n=0;n<a.length;n++){a[n].align="left";a[n].width=0}var s=FlexGrid._getSerializableProperties(Row);this.rows.forEach((function(e){var r=e.dataItem._rowInfo;if(r){o._copyProps(r,e,s,["showDropDown","width","size"]);if(o._hasColumnGroups())for(var t=0;t<a.length;t++){var n=o._grpHdl.getColumnGroup(e.index,t);n&&o._updateRowHeaders(e.index,t,n)}else a.length&&o._updateRowHeaders(e.index,a.length-1,r)}}));for(n=0;n<a.length;n++)0===a[n].width&&(a[n].width=this.columns.defaultSize);e.prototype.onLoadedRows.call(this,r)};TransposedGrid.prototype._getBindingColumn=function(e,r,o){var t=o;if(e!=this.cells)return t;var n=e.rows[r].dataItem._rowInfo;if(isUndefined(n))return t;t=new Column;var i=FlexGrid._getSerializableProperties(Column);this._copyProps(n,t,i);t.binding=o.binding;t.header=n.header||toHeaderCase(n.binding);return t};TransposedGrid.prototype._copyProps=function(e,r,o,t){void 0===t&&(t=[]);for(var n in e)if(o.indexOf(n)>-1&&-1===t.indexOf(n)){var i=e[n];if(!isUndefined(i))try{r[n]=i}catch(e){}}};TransposedGrid.prototype._updateRowHeaders=function(e,r,o){var t=o.header||toHeaderCase(o.binding);this.rowHeaders.setCellData(e,r,t);var n=this.rowHeaders.columns,i=o.width;if(isNumber(i)&&i>0){var a=o._rng;if(a&&a instanceof CellRange&&a.isValid){var s=a.columnSpan;assert(s>0,"Column span is negative or equal to 0");i/=s}n[r].width=Math.max(n[r].width,i)}};TransposedGrid.prototype._rowInfoChanged=function(){var e=this;this._toRowInfo&&clearTimeout(this._toRowInfo);this._toRowInfo=setTimeout((function(){var r=e.selection,o=e.itemsSource;e.itemsSource=null;e.itemsSource=o;e.selection=r}),Control._REFRESH_INTERVAL)};TransposedGrid.prototype._sourceViewChanged=function(e,r){this.activeEditor||this.invalidate()};TransposedGrid.prototype._transposeItemsSource=function(e){var r=this,o=new ObservableArray,t=getTypes(e),n=e.map((function(e,o){return r._keyPrefix+o}));(this.autoGenerateRows?this._getRowInfo(e):this._rowInfo).forEach((function(i,a){var s=new Binding(i.binding);if(null==i.dataType&&e.length){var l=s.getValue(e[0]);i.dataType=null!=l?getType(l):t[a].dataType}if(r._supportsProxies()){var u=r._createProxy(e,i,n);o.push(u)}else{var d=r._createTransposedObject(e,i,r._keyPrefix);o.push(d)}}));e instanceof ObservableArray&&e.collectionChanged.addHandler((function(e,t){if(t.action===NotifyCollectionChangedAction.Change)r.activeEditor||r.invalidate();else{var n=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset);o.onCollectionChanged(n);r._rowInfoChanged()}}));return o};TransposedGrid.prototype._supportsProxies=function(){return null!=window.Proxy};TransposedGrid.prototype._createProxy=function(e,r,o){var t={_arr:e,_rowInfo:r,_bnd:new Binding(r.binding),_keys:o};return new Proxy(t,{ownKeys:function(e){return e._keys},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0,writable:!0}},get:function(e,r){var o=e._keys.indexOf(r);return o>-1?e._bnd.getValue(e._arr[o]):e[r]},set:function(e,r,o){var t=e._keys.indexOf(r);if(t>-1){var n=e._arr,i=n[t];e._bnd.setValue(i,o);if(n instanceof ObservableArray){var a=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,i,t);n.onCollectionChanged(a)}return!0}return!1}})};TransposedGrid.prototype._createTransposedObject=function(e,r,o){for(var t={_arr:e,_rowInfo:r},n=new Binding(r.binding),_loop_1=function(r){var i=e[r];Object.defineProperty(t,o+r,{enumerable:!0,get:function(){return n.getValue(i)},set:function(o){n.setValue(i,o);if(e instanceof ObservableArray){var t=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,i,r);e.onCollectionChanged(t)}return!0}})},i=0;i<e.length;i++)_loop_1(i);return t};TransposedGrid.prototype._getRowInfo=function(e){var r=this,o=[];getTypes(e).forEach((function(e){var t=e.binding,n=e.dataType;if(n!=DataType.Object&&n!=DataType.Array){var i={binding:t,header:toHeaderCase(t),dataType:n},a=FlexGrid._defTypeWidth[n];if(null!=a){if(isString(a)){var s=Math.round(parseFloat(a));a=a.indexOf("*")<0?s:s*r.columns.defaultSize}isNumber(a)&&a>0&&(i.width=a)}o.push(i)}}));return o};return TransposedGrid}(FlexGrid);export{TransposedGrid};var TransposedGridRow=function(e){__extends(TransposedGridRow,e);function TransposedGridRow(){return null!==e&&e.apply(this,arguments)||this}Object.defineProperty(TransposedGridRow.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!0,configurable:!0});return TransposedGridRow}(Column);export{TransposedGridRow};var _RowGroupHandler=function(e){__extends(_RowGroupHandler,e);function _RowGroupHandler(r){return e.call(this,r)||this}_RowGroupHandler.prototype.createColumnGroups=function(e){this._createRowGroups(e)};_RowGroupHandler.prototype.getColumnGroup=function(e,r){var o=this._grid;if(r<o.rowHeaders.columns.length&&e<o._rowInfo.length)for(var t=this._colGroups;t;){for(var n=t,i=0;i<t.length;i++){var a=t[i],s=a._rng;if(s.containsRow(e)){if(s.containsColumn(r)||0==a.columns.length)return a;t=a.columns;break}}if(t==n)break}return null};_RowGroupHandler.prototype._createRowGroups=function(e){var r=this,o=this._grid;this._groupDefs=asArray(e);o.autoGenerateRows=!1;o._rowInfo.clear();this._colGroups=[];e.forEach((function(e){r._colGroups.push(new _RowGroup(e,null))}));var t=1;this._colGroups.forEach((function(e){r._addRowGroup(e);t=Math.max(t,e._getMaxLevel())}));this._colGroups.forEach((function(e){e._expandRange(t)}));var n=o.rowHeaders.columns;n.clear();for(var i=0;i<=t;i++){var a=new Column;n.splice(i,0,a);i<t&&(a.cssClassAll="wj-colgroup")}};_RowGroupHandler.prototype._addRowGroup=function(e){var r=this,o=this._grid;e._grid=o;e._rng.row=o._rowInfo.length;0==e.columns.length?o._rowInfo.push(e):e.columns.forEach((function(e){r._addRowGroup(e)}));e._rng.row2=o._rowInfo.length-1};return _RowGroupHandler}(_ColumnGroupHandler);export{_RowGroupHandler};var _RowGroup=function(e){__extends(_RowGroup,e);function _RowGroup(r,o){var t=e.call(this,null,o)||this;t._pGrp=o;t._lvl=0;for(var n=o;n;n=n._pGrp)t._lvl++;t._rng=new CellRange(-1,0);t._rng.col=t._rng.col2=t._lvl;t.allowDragging=!1;copy(t,r);return t}Object.defineProperty(_RowGroup.prototype,"columns",{get:function(){return this._cols},set:function(e){var r=this,o=this._cols=[];e.forEach((function(e){var t=new _RowGroup(e,r);o.indexOf(t)<0&&o.push(t)}))},enumerable:!0,configurable:!0});Object.defineProperty(_RowGroup.prototype,"rows",{get:function(){return this._cols},enumerable:!0,configurable:!0});Object.defineProperty(_RowGroup.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!0,configurable:!0});_RowGroup.prototype._copy=function(e,r){if(/rows|columns/.test(e)){var o=asArray(r);this.columns=o;return!0}return!1};_RowGroup.prototype._updateCollapsedState=function(){var e=this._grid._rowInfo,r=this._rng,o=this._collapsed;this._cols.forEach((function(e){if(e instanceof _RowGroup){e._collapsed=o;e._updateCollapsedState()}}));var t=r.bottomRow;if(this.collapseTo)switch(this.collapseTo){case"$first":t=r.topRow;break;case"$last":t=r.bottomRow;break;default:var n=e.indexOf(this.collapseTo);n>-1&&(t=n)}for(var i=r.topRow;i<=r.bottomRow;i++)e[i].visible=!o||i==t};_RowGroup.prototype._expandRange=function(e){var r=e-this._getMaxLevel();if(r>0){this._rng.col2+=r;this._cols.forEach((function(e){e._shiftRange(r)}))}for(var o=this._grid._rowInfo,t=this._rng,n=t.row;n<=t.row2;n++){o[n]._rng.col2=e}};_RowGroup.prototype._shiftRange=function(e){this._rng.col+=e;this._rng.col2+=e;this._cols.forEach((function(r){r._shiftRange(e)}))};return _RowGroup}(ColumnGroup);export{_RowGroup};_registerModule("wijmo.grid.transposed",selfModule);